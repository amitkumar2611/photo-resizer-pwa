<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Photo Resizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#2196F3">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 2rem 1rem;
      max-width: 900px;
      margin: auto;
      background: linear-gradient(135deg, #e0f7fa, #ffe0f0);
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 1.5rem;
      font-size: 2rem;
    }
    input, select, button {
      margin: 0.5rem 0.3rem;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    button {
      cursor: pointer;
      background-color: #2196F3;
      color: white;
      border: none;
    }
    button:hover {
      background-color: #1976D2;
    }
    .control-group {
      text-align: center;
      margin-bottom: 1rem;
    }
    .photo-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: center;
      margin-top: 2rem;
    }
    .canvas-container {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    canvas {
      border: 1px solid #ccc;
      margin-bottom: 0.5rem;
      max-width: 100%;
    }
    #custom-size {
      display: none;
    }
  </style>
</head>
<body>

<h1>üì∏ Smart Photo Resizer</h1>

<div class="control-group">
  <input type="file" id="upload" accept="image/*" multiple><br>

  <label><input type="radio" name="size" value="passport" checked> Passport Size (600x600)</label>
  <label><input type="radio" name="size" value="custom"> Custom Size</label><br>

  <span id="custom-size">
    Width: <input type="number" id="customWidth" value="400" style="width:80px;"> px
    Height: <input type="number" id="customHeight" value="600" style="width:80px;"> px
  </span><br>

  <label for="bgColor">Background:</label>
  <select id="bgColor">
    <option value="white">White</option>
    <option value="red">Red</option>
    <option value="blue">Blue</option>
  </select><br>

  <button onclick="resizeAll()">Resize</button>
  <button onclick="downloadAllAsZip()" style="background-color: #4CAF50;">Download All as ZIP</button>
  <button onclick="clearAll()" style="background-color: #f44336;">Clear All</button>
</div>

<div class="photo-preview" id="previewArea"></div>

<script>
  const upload = document.getElementById('upload');
  const previewArea = document.getElementById('previewArea');
  let resizedImages = [];

  document.querySelectorAll('input[name="size"]').forEach(radio => {
    radio.addEventListener('change', () => {
      document.getElementById('custom-size').style.display =
        document.querySelector('input[name="size"]:checked').value === 'custom' ? 'inline-block' : 'none';
    });
  });

  function resizeAll() {
    previewArea.innerHTML = '';
    resizedImages = []; // clear previous
    const files = upload.files;
    const bgColor = document.getElementById('bgColor').value;

    const sizeType = document.querySelector('input[name="size"]:checked').value;
    let width = 600, height = 600;

    if (sizeType === 'custom') {
      width = parseInt(document.getElementById('customWidth').value, 10);
      height = parseInt(document.getElementById('customHeight').value, 10);
    }

    if (!files.length) {
      alert("Please upload at least one image.");
      return;
    }

    Array.from(files).forEach(file => {
      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = width;
          canvas.height = height;

          ctx.fillStyle = bgColor;
          ctx.fillRect(0, 0, width, height);

          const aspectRatio = img.width / img.height;
          let drawWidth = width, drawHeight = height;

          if (img.width > img.height) {
            drawHeight = width / aspectRatio;
            if (drawHeight > height) {
              drawHeight = height;
              drawWidth = height * aspectRatio;
            }
          } else {
            drawWidth = height * aspectRatio;
            if (drawWidth > width) {
              drawWidth = width;
              drawHeight = width / aspectRatio;
            }
          }

          const offsetX = (width - drawWidth) / 2;
          const offsetY = (height - drawHeight) / 2;

          ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);

          const imgURL = canvas.toDataURL('image/png');
          resizedImages.push({ name: `resized_${file.name}`, data: imgURL });

          const container = document.createElement('div');
          container.className = 'canvas-container';
          container.innerHTML = `
            <canvas width="${width}" height="${height}"></canvas><br>
            <a href="${imgURL}" download="resized_${file.name}">
              <button>Download</button>
            </a>
          `;
          container.querySelector('canvas').getContext('2d').drawImage(canvas, 0, 0);
          previewArea.appendChild(container);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    });
  }

  function clearAll() {
    upload.value = "";
    previewArea.innerHTML = "";
    resizedImages = [];
    document.getElementById('customWidth').value = 400;
    document.getElementById('customHeight').value = 600;
    document.querySelector('input[value="passport"]').checked = true;
    document.getElementById('custom-size').style.display = 'none';
    document.getElementById('bgColor').value = 'white';
  }

  function downloadAllAsZip() {
    if (resizedImages.length === 0) {
      alert("No resized images to download. Please resize first.");
      return;
    }

    const zip = new JSZip();
    resizedImages.forEach(img => {
      const base64Data = img.data.split(',')[1];
      zip.file(img.name, base64Data, { base64: true });
    });

    zip.generateAsync({ type: "blob" }).then(function (content) {
      saveAs(content, "resized_photos.zip");
    });
  }
</script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('‚úÖ Service Worker registered!', reg))
      .catch(err => console.error('‚ö†Ô∏è Service Worker failed:', err));
  }
</script>

</body>
</html>